/*
 * promise-tracker - v1.3.3 - 2013-04-29
 * http://github.com/ajoslin/angular-promise-tracker
 * Created by Andy Joslin; Licensed under Public Domain
 */
angular.module("ajoslin.promise-tracker",[]),angular.module("ajoslin.promise-tracker").factory("trackerResponseInterceptor",["$q","promiseTracker","$injector",function(r,e,n){var t;return function(r){t||(t=n.get("$http"));var o=t.pendingRequests[t.pendingRequests.length-1];return o.tracker&&e(o.tracker).addPromise(r,o),r}}]).factory("trackerHttpInterceptor",["$q","promiseTracker","$injector",function(r,e){return{request:function(n){if(n.tracker){var t=e(n.tracker).createPromise(n);n.$promiseTrackerDeferred=t}return r.when(n)},response:function(e){return e.config.$promiseTrackerDeferred&&e.config.$promiseTrackerDeferred.resolve(e),r.when(e)},responseError:function(e){return e.config.$promiseTrackerDeferred&&e.config.$promiseTrackerDeferred.reject(e),r.reject(e)}}}]).config(["$httpProvider",function(r){r.interceptors?r.interceptors.push("trackerHttpInterceptor"):r.responseInterceptors.push("trackerResponseInterceptor")}]),angular.module("ajoslin.promise-tracker").provider("promiseTracker",function(){function r(){for(var r,n=e.length;n;){if(n--,r=e[n].charCodeAt(0),57===r)return e[n]="A",e.join("");if(90!==r)return e[n]=String.fromCharCode(r+1),e.join("");e[n]="0"}return e.unshift("0"),e.join("")}var e=["0","0","0"],n={};this.$get=["$q","$timeout",function(e,t){function o(n){function o(r){angular.forEach(c[r.event],function(e){e.call(a,r.value,r.id)})}function i(n){function i(r){return function(e){a.minPromise.then(function(){o({event:r?"error":"success",id:s,value:e}),o({event:"done",id:s,value:e});var n=u.indexOf(c);u.splice(n,1),0===u.length&&a.maxPromise&&t.cancel(a.maxPromise)})}}var c=e.defer(),s=r();return u.push(c),o({event:"start",id:s,value:n}),1===u.length&&(a.minPromise=a._minDuration?t(angular.noop,a._minDuration):e.when(!0),a._maxDuration&&(a.maxPromise=t(c.resolve,a._maxDuration))),c.promise.then(i(!1),i(!0)),c}n=n||{};var a=this,c={start:[],done:[],error:[],success:[]},u=[];a.setMinDuration=function(r){a._minDuration=r},a.setMinDuration(n.minDuration),a.setMaxDuration=function(r){a._maxDuration=r},a.setMaxDuration(n.maxDuration),a.active=function(){return u.length>0},a.cancel=function(){angular.forEach(u,function(r){r.resolve()})},a.addPromise=function(r,n){var t=i(n);return(r.$then||r.then)(function(r){return t.resolve(r),r},function(r){return t.reject(r),e.reject(r)}),t},a.createPromise=function(r){return i(r)},a.on=a.bind=function(r,e){if(!c[r])throw"Cannot create callback for event '"+r+"'. Allowed types: 'start', 'done', 'error', 'success'";return c[r].push(e),a},a.off=a.unbind=function(r,e){if(!c[r])throw"Cannot create callback for event '"+r+"'. Allowed types: 'start', 'done', 'error', 'success'";if(e){var n=c[r].indexOf(e);c[r].splice(n,1)}else c[r].length=0;return a}}return function(r,e){return n[r]||(n[r]=new o(e)),n[r]}}]});